# 客製化頁面設計指南（進階版）

## 概述

本指南將幫助進階開發者創建複雜的客製化頁面，這些頁面可以整合到 PlayBook 學習流程中。客製化頁面允許您創建互動式的學習內容，包括遊戲、模擬器、互動式圖表等。

## 目錄

1. [快速開始](#快速開始)
2. [檔案結構要求](#檔案結構要求)
3. [命名規範](#命名規範)
4. [配置檔案說明](#配置檔案說明)
5. [進度控制機制](#進度控制機制)
6. [與 PlayBook 的整合](#與-playbook-的整合)
7. [完整範例](#完整範例)
8. [最佳實踐](#最佳實踐)
9. [常見問題](#常見問題)
10. [故障排除](#故障排除)

## 快速開始

### 步驟 1：準備工作環境

1. 創建一個新的資料夾，命名為您的頁面名稱（例如：`my-interactive-lesson`）
2. 準備以下基本檔案：
   - `index.html` - 主要頁面檔案
   - `config.json` - 配置檔案
   - 其他資源檔案（CSS、JavaScript、圖片等）

### 步驟 2：創建基本結構

```
my-interactive-lesson/
├── index.html          # 主要頁面檔案
├── config.json         # 配置檔案
├── styles/
│   └── main.css        # 樣式檔案
├── scripts/
│   └── main.js         # JavaScript 檔案
└── assets/
    └── images/         # 圖片資源
```

### 步驟 3：打包上傳

1. 將所有檔案壓縮成 ZIP 格式
2. 在 PlayBoard 管理後台上傳 ZIP 檔案
3. 系統會自動解壓縮並驗證檔案結構

## 檔案結構要求

### 必要檔案

#### 1. index.html（主要頁面檔案）

- **位置**：必須在 ZIP 檔案的根目錄
- **用途**：客製化頁面的主要 HTML 檔案
- **要求**：
  - 必須是有效的 HTML5 檔案
  - 建議包含完整的 HTML 結構（DOCTYPE、html、head、body）
  - 檔案大小限制：10MB

#### 2. config.json（配置檔案）

- **位置**：必須在 ZIP 檔案的根目錄
- **用途**：定義頁面的基本資訊和行為設定
- **要求**：必須是有效的 JSON 格式

### 可選檔案

- CSS 樣式檔案
- JavaScript 檔案
- 圖片、音頻、視頻等媒體檔案
- 字體檔案
- 其他靜態資源

## 命名規範

### 檔案命名規則

1. **檔案名稱**：
   - 只能包含英文字母、數字、連字符（-）和底線（_）
   - 不能包含空格或特殊字符
   - 建議使用小寫字母
   - 範例：`main.css`、`interactive-game.js`、`background-image.png`

2. **資料夾名稱**：
   - 遵循與檔案名稱相同的規則
   - 建議使用有意義的名稱
   - 範例：`styles`、`scripts`、`assets`、`images`

3. **避免的命名**：
   - 不要使用中文或特殊字符
   - 不要使用保留字（如 `config`、`admin`、`api` 等）
   - 不要使用過長的名稱（建議不超過 50 個字符）

### 資源路徑規範

1. **相對路徑**：
   - 所有資源引用必須使用相對路徑
   - 從 `index.html` 的位置開始計算
   - 範例：`./styles/main.css`、`./assets/images/logo.png`

2. **絕對路徑**：
   - 不支援絕對路徑
   - 不支援外部 URL 引用（安全考量）

## 配置檔案說明

### config.json 結構

```json
{
  "pageInfo": {
    "title": "頁面標題",
    "description": "頁面描述",
    "version": "1.0.0",
    "author": "作者名稱"
  },
  "settings": {
    "entryFile": "index.html",
    "autoProgress": false,
    "progressTrigger": "manual",
    "allowFullscreen": true,
    "enableKeyboard": true
  },
  "requirements": {
    "minWidth": 800,
    "minHeight": 600,
    "supportedBrowsers": ["chrome", "firefox", "safari", "edge"]
  }
}
```

### 配置參數詳解

#### pageInfo 區塊

| 參數 | 類型 | 必填 | 說明 |
|------|------|------|------|
| title | String | 是 | 頁面標題，將顯示在 PlayBook 中 |
| description | String | 否 | 頁面描述，用於說明頁面內容 |
| version | String | 否 | 版本號，用於版本管理 |
| author | String | 否 | 作者資訊 |

#### settings 區塊

| 參數 | 類型 | 必填 | 說明 |
|------|------|------|------|
| entryFile | String | 是 | 入口檔案名稱，預設為 "index.html" |
| autoProgress | Boolean | 是 | 是否自動進入下一步 |
| progressTrigger | String | 是 | 進度觸發方式：manual、time、event |
| allowFullscreen | Boolean | 否 | 是否允許全螢幕模式 |
| enableKeyboard | Boolean | 否 | 是否啟用鍵盤支援 |

#### requirements 區塊

| 參數 | 類型 | 必填 | 說明 |
|------|------|------|------|
| minWidth | Number | 否 | 最小顯示寬度（像素） |
| minHeight | Number | 否 | 最小顯示高度（像素） |
| supportedBrowsers | Array | 否 | 支援的瀏覽器列表 |

## 進度控制機制

### 進度觸發方式

#### 1. manual（手動觸發）

用戶需要手動點擊「下一步」按鈕才能繼續。

```javascript
// 在您的 JavaScript 中，當用戶完成任務時：
window.parent.postMessage({
  type: 'CUSTOM_PAGE_PROGRESS',
  action: 'complete',
  data: {
    completed: true,
    score: 100,
    timeSpent: 120 // 秒
  }
}, '*');
```

#### 2. time（時間觸發）

設定固定時間後自動進入下一步。

```json
{
  "settings": {
    "progressTrigger": "time",
    "timeLimit": 300
  }
}
```

#### 3. event（事件觸發）

監聽特定事件來觸發進度更新。

```javascript
// 監聽特定事件
document.addEventListener('taskCompleted', function(event) {
  window.parent.postMessage({
    type: 'CUSTOM_PAGE_PROGRESS',
    action: 'complete',
    data: event.detail
  }, '*');
});
```

### 進度更新 API

#### 完成頁面

```javascript
window.parent.postMessage({
  type: 'CUSTOM_PAGE_PROGRESS',
  action: 'complete',
  data: {
    completed: true,
    score: 85,
    timeSpent: 180,
    attempts: 2,
    customData: {
      // 自定義數據
      level: 3,
      achievements: ['first_try', 'speed_bonus']
    }
  }
}, '*');
```

#### 更新進度

```javascript
window.parent.postMessage({
  type: 'CUSTOM_PAGE_PROGRESS',
  action: 'update',
  data: {
    progress: 0.6, // 0-1 之間的進度值
    currentStep: 3,
    totalSteps: 5
  }
}, '*');
```

#### 報告錯誤

```javascript
window.parent.postMessage({
  type: 'CUSTOM_PAGE_PROGRESS',
  action: 'error',
  data: {
    error: 'Network connection failed',
    code: 'NETWORK_ERROR'
  }
}, '*');
```

## 與 PlayBook 的整合

### 在 PlayBook 中新增客製化頁面

1. 在 PlayBook 編輯器中，選擇步驟類型為「客製化頁面」
2. 從下拉選單中選擇已上傳的客製化頁面
3. 設定步驟標題和描述
4. 配置時間限制（可選）

### 進度追蹤

系統會自動追蹤以下數據：

- 完成狀態
- 花費時間
- 嘗試次數
- 分數（如果提供）
- 自定義數據

## 完整範例

### 範例 1：簡單互動頁面

#### 檔案結構

```
simple-quiz/
├── index.html
├── config.json
├── styles/
│   └── quiz.css
└── scripts/
    └── quiz.js
```

#### config.json

```json
{
  "pageInfo": {
    "title": "簡單測驗",
    "description": "一個基本的互動測驗頁面",
    "version": "1.0.0",
    "author": "PlayBoard Team"
  },
  "settings": {
    "entryFile": "index.html",
    "autoProgress": false,
    "progressTrigger": "manual",
    "allowFullscreen": true,
    "enableKeyboard": true
  },
  "requirements": {
    "minWidth": 800,
    "minHeight": 600,
    "supportedBrowsers": ["chrome", "firefox", "safari", "edge"]
  }
}
```

#### index.html

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡單測驗</title>
    <link rel="stylesheet" href="./styles/quiz.css">
</head>
<body>
    <div class="quiz-container">
        <h1>歡迎來到互動測驗</h1>
        <div class="question" id="question">
            <h2>問題 1：什麼是 PlayBoard？</h2>
            <div class="options">
                <button class="option" data-value="a">A. 一個學習管理系統</button>
                <button class="option" data-value="b">B. 一個遊戲平台</button>
                <button class="option" data-value="c">C. 一個社交媒體</button>
                <button class="option" data-value="d">D. 一個購物網站</button>
            </div>
        </div>
        <div class="result" id="result" style="display: none;">
            <h3>測驗完成！</h3>
            <p>您的分數：<span id="score">0</span>/100</p>
            <button id="completeBtn">完成測驗</button>
        </div>
    </div>
    <script src="./scripts/quiz.js"></script>
</body>
</html>
```

#### scripts/quiz.js

```javascript
class SimpleQuiz {
    constructor() {
        this.questions = [
            {
                question: "什麼是 PlayBoard？",
                options: [
                    "一個學習管理系統",
                    "一個遊戲平台", 
                    "一個社交媒體",
                    "一個購物網站"
                ],
                correct: 0
            },
            {
                question: "PlayBoard 支援哪些內容類型？",
                options: [
                    "只有文字內容",
                    "文字、測驗、問卷",
                    "只有視頻內容",
                    "只有圖片內容"
                ],
                correct: 1
            }
        ];
        
        this.currentQuestion = 0;
        this.score = 0;
        this.startTime = Date.now();
        
        this.init();
    }
    
    init() {
        this.setupEventListeners();
        this.showQuestion();
    }
    
    setupEventListeners() {
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('option')) {
                this.handleAnswer(e.target.dataset.value);
            }
            
            if (e.target.id === 'completeBtn') {
                this.completeQuiz();
            }
        });
    }
    
    showQuestion() {
        const question = this.questions[this.currentQuestion];
        const questionEl = document.getElementById('question');
        
        questionEl.innerHTML = `
            <h2>問題 ${this.currentQuestion + 1}：${question.question}</h2>
            <div class="options">
                ${question.options.map((option, index) => 
                    `<button class="option" data-value="${index}">${String.fromCharCode(65 + index)}. ${option}</button>`
                ).join('')}
            </div>
        `;
    }
    
    handleAnswer(selectedIndex) {
        const question = this.questions[this.currentQuestion];
        const isCorrect = parseInt(selectedIndex) === question.correct;
        
        if (isCorrect) {
            this.score += 50; // 每題 50 分
        }
        
        this.currentQuestion++;
        
        if (this.currentQuestion < this.questions.length) {
            this.showQuestion();
        } else {
            this.showResult();
        }
    }
    
    showResult() {
        document.getElementById('question').style.display = 'none';
        document.getElementById('result').style.display = 'block';
        document.getElementById('score').textContent = this.score;
    }
    
    completeQuiz() {
        const timeSpent = Math.round((Date.now() - this.startTime) / 1000);
        
        // 發送完成訊息給父視窗
        window.parent.postMessage({
            type: 'CUSTOM_PAGE_PROGRESS',
            action: 'complete',
            data: {
                completed: true,
                score: this.score,
                timeSpent: timeSpent,
                attempts: 1,
                customData: {
                    questionsAnswered: this.questions.length,
                    correctAnswers: this.score / 50
                }
            }
        }, '*');
    }
}

// 初始化測驗
document.addEventListener('DOMContentLoaded', () => {
    new SimpleQuiz();
});
```

### 範例 2：遊戲化學習頁面

#### config.json

```json
{
  "pageInfo": {
    "title": "記憶配對遊戲",
    "description": "透過配對遊戲學習新概念",
    "version": "1.0.0",
    "author": "PlayBoard Team"
  },
  "settings": {
    "entryFile": "index.html",
    "autoProgress": false,
    "progressTrigger": "manual",
    "allowFullscreen": true,
    "enableKeyboard": true
  },
  "requirements": {
    "minWidth": 1000,
    "minHeight": 700,
    "supportedBrowsers": ["chrome", "firefox", "safari", "edge"]
  }
}
```

## 最佳實踐

### 1. 設計原則

- **響應式設計**：確保頁面在不同螢幕尺寸下都能正常顯示
- **無障礙設計**：考慮視覺障礙用戶的需求
- **效能優化**：壓縮圖片、最小化 JavaScript 和 CSS
- **錯誤處理**：提供適當的錯誤訊息和恢復機制

### 2. 用戶體驗

- **清晰的指示**：提供明確的操作指引
- **即時回饋**：對用戶操作提供即時回應
- **進度指示**：顯示學習進度
- **適當的挑戰**：平衡難度，避免過於簡單或困難

### 3. 技術建議

- **模組化設計**：將功能分離到不同的檔案
- **事件驅動**：使用事件來處理用戶互動
- **數據驗證**：驗證用戶輸入和進度數據
- **相容性測試**：在主要瀏覽器中測試

### 4. 安全性考量

- **輸入驗證**：驗證所有用戶輸入
- **XSS 防護**：避免跨站腳本攻擊
- **數據清理**：清理敏感資訊
- **沙盒環境**：在 iframe 中安全執行

## 常見問題

### Q1：為什麼我的頁面無法載入？

**可能原因：**
- `index.html` 檔案不在 ZIP 根目錄
- `config.json` 格式錯誤
- 檔案路徑使用絕對路徑而非相對路徑

**解決方法：**
1. 檢查檔案結構
2. 驗證 JSON 格式
3. 使用相對路徑引用資源

### Q2：如何調試進度更新問題？

**調試步驟：**
1. 開啟瀏覽器開發者工具
2. 查看 Console 是否有錯誤訊息
3. 檢查 postMessage 是否正確發送
4. 驗證數據格式是否符合要求

### Q3：頁面在 iframe 中顯示異常怎麼辦？

**常見問題：**
- CSS 樣式被覆蓋
- JavaScript 事件無法正常觸發
- 資源載入失敗

**解決方法：**
1. 使用 `!important` 確保樣式優先級
2. 檢查事件監聽器設定
3. 使用相對路徑載入資源

### Q4：如何處理不同瀏覽器的相容性？

**建議：**
1. 使用標準的 HTML5、CSS3 和 ES6+ 語法
2. 避免使用實驗性功能
3. 在主要瀏覽器中測試
4. 提供降級方案

## 故障排除

### 1. 上傳失敗

**錯誤訊息：** "檔案上傳失敗"

**可能原因：**
- ZIP 檔案損壞
- 檔案大小超過限制
- 網路連線問題

**解決方法：**
1. 重新壓縮檔案
2. 檢查檔案大小（限制 50MB）
3. 檢查網路連線

### 2. 解壓縮失敗

**錯誤訊息：** "檔案解壓縮失敗"

**可能原因：**
- ZIP 檔案格式不正確
- 包含不支援的檔案類型
- 檔案路徑過長

**解決方法：**
1. 使用標準 ZIP 格式
2. 避免使用特殊字符的檔案名
3. 簡化資料夾結構

### 3. 配置驗證失敗

**錯誤訊息：** "配置檔案格式錯誤"

**可能原因：**
- JSON 語法錯誤
- 缺少必要欄位
- 欄位值格式不正確

**解決方法：**
1. 使用 JSON 驗證工具檢查語法
2. 參考配置檔案說明
3. 確保所有必填欄位都有值

### 4. 頁面載入失敗

**錯誤訊息：** "頁面載入失敗"

**可能原因：**
- `index.html` 不存在
- HTML 語法錯誤
- 資源載入失敗

**解決方法：**
1. 確認 `index.html` 在根目錄
2. 驗證 HTML 語法
3. 檢查資源路徑

### 5. 進度更新失敗

**錯誤訊息：** "進度更新失敗"

**可能原因：**
- postMessage 格式錯誤
- 父視窗通訊失敗
- 數據格式不正確

**解決方法：**
1. 檢查 postMessage 格式
2. 確認在 iframe 環境中執行
3. 驗證數據結構

## 技術支援

如果您在創建客製化頁面時遇到問題，可以：

1. 查看本指南的常見問題部分
2. 檢查瀏覽器開發者工具的錯誤訊息
3. 參考提供的範例代碼
4. 聯繫技術支援團隊

## 更新日誌

- **v1.0.0** (2024-01-XX)：初始版本發布
  - 基本功能說明
  - 配置檔案格式定義
  - 進度控制機制
  - 完整範例和最佳實踐

---

**注意：** 本指南會根據系統更新持續改進，請定期查看最新版本。
