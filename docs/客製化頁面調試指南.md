# 客製化頁面調試指南

## 概述

本指南提供客製化頁面功能的詳細調試步驟，幫助開發者快速定位和修復問題。

## 調試工具

### 1. 瀏覽器開發者工具
- **F12** 開啟開發者工具
- **Console** 標籤查看錯誤訊息
- **Network** 標籤檢查 API 請求
- **Application** 標籤檢查本地存儲

### 2. 服務器日誌
- 檢查 Node.js 控制台輸出
- 查看錯誤堆疊追蹤
- 監控 API 請求日誌

## 常見問題調試

### 問題 1: 查看功能無效

#### 調試步驟

1. **檢查前端 URL 構建**
   ```javascript
   // 在 CustomPageList.vue 的 viewPage 函數中新增調試
   console.log('Custom Page:', customPage);
   console.log('Base URL:', baseUrl);
   console.log('Final URL:', url);
   ```

2. **檢查後端路由**
   ```bash
   # 測試 API 端點
   curl -X GET "http://localhost:3000/api/custom-pages/public/available"
   ```

3. **檢查檔案是否存在**
   ```javascript
   // 在 serveCustomPage 中新增調試
   console.log('Looking for file:', filePath);
   console.log('File exists:', fs.existsSync(filePath));
   ```

4. **檢查資料庫記錄**
   ```javascript
   // 在 serveCustomPage 中新增調試
   console.log('Custom Page from DB:', customPage);
   console.log('Slug:', customPage.slug);
   console.log('Entry File:', customPage.entryFile);
   ```

#### 可能的問題和解決方案

| 問題 | 原因 | 解決方案 |
|------|------|----------|
| 404 錯誤 | 檔案不存在 | 檢查解壓縮目錄和檔案路徑 |
| 空白頁面 | HTML 內容為空 | 檢查檔案讀取權限 |
| 權限錯誤 | 檔案權限問題 | 設定正確的檔案權限 |

### 問題 2: 編輯功能無效

#### 調試步驟

1. **檢查組件通信**
   ```javascript
   // 在 CustomPageList.vue 的 editPage 函數中新增調試
   console.log('Selected Custom Page:', customPage);
   console.log('Show Edit Dialog:', showEditDialog.value);
   ```

2. **檢查表單數據**
   ```javascript
   // 在 CustomPageEditDialog.vue 的 handleSave 函數中新增調試
   console.log('Form Data:', form.value);
   console.log('Update Data:', updateData);
   ```

3. **檢查 API 請求**
   ```javascript
   // 在 customPageService.updateCustomPage 中新增調試
   console.log('API Request:', { id, data });
   console.log('API Response:', response.data);
   ```

4. **檢查後端處理**
   ```javascript
   // 在 updateCustomPage 控制器中新增調試
   console.log('Request Body:', req.body);
   console.log('Custom Page ID:', req.params.id);
   console.log('Updated Custom Page:', customPage);
   ```

#### 可能的問題和解決方案

| 問題 | 原因 | 解決方案 |
|------|------|----------|
| 對話框不打開 | 組件綁定問題 | 檢查 v-model 和事件處理 |
| 表單驗證失敗 | 驗證規則問題 | 檢查表單驗證邏輯 |
| 更新失敗 | API 請求問題 | 檢查請求數據格式 |

### 問題 3: 檔案解壓縮問題

#### 調試步驟

1. **檢查解壓縮目錄**
   ```javascript
   // 在 fileProcessor.js 中新增調試
   console.log('Extract Path:', extractPath);
   console.log('Directory exists:', fs.existsSync(extractPath));
   ```

2. **檢查檔案結構**
   ```javascript
   // 列出解壓縮後的檔案
   const files = fs.readdirSync(extractPath, { recursive: true });
   console.log('Extracted files:', files);
   ```

3. **檢查檔案權限**
   ```javascript
   // 檢查檔案權限
   const stats = fs.statSync(filePath);
   console.log('File permissions:', stats.mode);
   ```

#### 可能的問題和解決方案

| 問題 | 原因 | 解決方案 |
|------|------|----------|
| 解壓縮失敗 | ZIP 檔案損壞 | 重新上傳檔案 |
| 檔案權限問題 | 權限設定錯誤 | 設定正確的檔案權限 |
| 路徑問題 | 路徑分隔符問題 | 使用 path.join() 構建路徑 |

## 調試腳本

### 1. 檢查客製化頁面狀態
```javascript
// 在瀏覽器控制台執行
fetch('/api/custom-pages')
  .then(response => response.json())
  .then(data => {
    console.log('Custom Pages:', data);
    data.data.forEach(page => {
      console.log(`Page: ${page.title}, Status: ${page.status}, Slug: ${page.slug}`);
    });
  });
```

### 2. 檢查檔案系統
```javascript
// 在 Node.js 控制台執行
const fs = require('fs');
const path = require('path');

const customPagesDir = path.join(__dirname, 'public/custom-pages');
console.log('Custom Pages Directory:', customPagesDir);
console.log('Directory exists:', fs.existsSync(customPagesDir));

if (fs.existsSync(customPagesDir)) {
  const pages = fs.readdirSync(customPagesDir);
  console.log('Available pages:', pages);
  
  pages.forEach(page => {
    const pageDir = path.join(customPagesDir, page);
    const files = fs.readdirSync(pageDir);
    console.log(`Page ${page} files:`, files);
  });
}
```

### 3. 測試 API 端點
```bash
# 測試獲取客製化頁面列表
curl -X GET "http://localhost:3000/api/custom-pages" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 測試獲取單個客製化頁面
curl -X GET "http://localhost:3000/api/custom-pages/PAGE_ID" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 測試公開訪問
curl -X GET "http://localhost:3000/api/custom-pages/public/PAGE_SLUG"
```

## 常見錯誤訊息

### 前端錯誤
```
TypeError: Cannot read property 'slug' of undefined
```
**解決方案**: 檢查 customPage 對象是否正確傳遞

```
Network Error: 404 Not Found
```
**解決方案**: 檢查 API 端點 URL 是否正確

### 後端錯誤
```
ENOENT: no such file or directory
```
**解決方案**: 檢查檔案路徑和檔案是否存在

```
EACCES: permission denied
```
**解決方案**: 檢查檔案權限設定

## 預防措施

### 1. 錯誤處理
- 在所有 API 調用中新增 try-catch
- 提供有意義的錯誤訊息
- 記錄詳細的錯誤日誌

### 2. 數據驗證
- 驗證輸入數據格式
- 檢查必要欄位是否存在
- 驗證檔案路徑和權限

### 3. 測試覆蓋
- 單元測試 API 端點
- 整合測試完整流程
- 端到端測試用戶操作

## 修復檢查清單

修復客製化頁面問題時，請按以下順序檢查：

- [ ] 檢查資料庫中的客製化頁面記錄
- [ ] 驗證檔案是否正確解壓縮
- [ ] 檢查檔案權限和路徑
- [ ] 測試 API 端點響應
- [ ] 驗證前端組件通信
- [ ] 測試完整的用戶流程
- [ ] 更新問題追蹤文檔

---

**注意**: 修復任何問題後，請更新 `docs/ISSUES_AND_BUGS.md` 文檔中的狀態。
