# PlayBoard 問題追蹤與修復清單

## 概述

本文檔記錄 PlayBoard 系統中發現的問題、bug 和需要修復的功能。每個問題都包含詳細的描述、重現步驟、預期行為和修復狀態。

## 相關文檔

- [客製化頁面調試指南](客製化頁面調試指南.md) - 詳細的調試步驟和工具
- [客製化頁面設計指南](客製化頁面設計指南.md) - 功能使用說明

## 問題分類

- 🔴 **Critical** - 嚴重問題，影響核心功能
- 🟡 **High** - 高優先級問題，影響用戶體驗
- 🟢 **Medium** - 中等優先級問題
- 🔵 **Low** - 低優先級問題
- ✅ **Fixed** - 已修復
- 🚧 **In Progress** - 修復中
- ❌ **Won't Fix** - 不會修復

---

## 客製化頁面功能問題

### Issue #001: 客製化頁面查看功能無效
- **狀態**: ✅ Fixed
- **優先級**: 🟡 High
- **發現日期**: 2024-01-XX
- **負責人**: 待分配

#### 問題描述
在管理後台的客製化頁面列表中，點擊「查看」按鈕無法正確打開客製化頁面。

#### 重現步驟
1. 登入管理後台
2. 進入「客製化頁面管理」頁面
3. 找到狀態為「就緒」的客製化頁面
4. 點擊「查看」按鈕
5. 觀察結果

#### 實際行為
- 新視窗打開但顯示錯誤頁面
- 或無法打開新視窗
- 控制台可能顯示 404 錯誤

#### 預期行為
- 新視窗應該正確顯示客製化頁面內容
- 頁面應該在 iframe 中正常載入

#### 技術細節
- **前端檔案**: `client/src/views/admin/CustomPageList.vue`
- **後端檔案**: `server/controllers/customPageController.js`
- **相關路由**: `/api/custom-pages/public/:slug`
- **問題類型**: URL 構建錯誤、檔案路徑問題

#### 已嘗試的修復
1. ✅ 修復了 `viewPage` 函數中的 URL 構建邏輯
2. ✅ 修復了 `serveCustomPage` 中的 `fs.readFile` 異步調用問題
3. ✅ 修復了 ZIP 檔案解壓縮路徑問題（移除重複的根目錄結構）
4. ✅ 手動修復了現有檔案的目錄結構
5. ✅ 新增了調試日誌來診斷檔案路徑問題
6. ✅ 修復了靜態資源載入問題（CSS、JS 檔案）
7. ❌ 新增了新的 API 端點來處理靜態資源，但導致服務器崩潰（path-to-regexp 錯誤）
8. ✅ 修改了 HTML 內容，將相對路徑轉換為正確的 API 端點
9. ✅ 修復了服務器崩潰問題（暫時移除有問題的通配符路由）

#### 需要進一步調查
- [ ] 檢查客製化頁面檔案是否正確解壓縮到指定目錄
- [ ] 驗證 `customPage.slug` 和 `customPage.entryFile` 的值
- [ ] 檢查檔案權限和路徑問題
- [ ] 測試不同瀏覽器的行為差異

#### 相關錯誤訊息
```
GET /api/custom-pages/public/[slug] 404 (Not Found)
或
找不到頁面檔案
```

---

### Issue #002: 客製化頁面編輯功能無效
- **狀態**: 🚧 In Progress
- **優先級**: 🟡 High
- **發現日期**: 2024-01-XX
- **負責人**: 待分配

#### 問題描述
在管理後台的客製化頁面列表中，點擊「編輯」按鈕無法正確打開編輯對話框或編輯功能不正常。

#### 重現步驟
1. 登入管理後台
2. 進入「客製化頁面管理」頁面
3. 找到任意客製化頁面
4. 點擊「編輯」按鈕
5. 嘗試修改並儲存

#### 實際行為
- 編輯對話框無法打開
- 或對話框打開但無法儲存變更
- 或儲存後變更沒有生效

#### 預期行為
- 編輯對話框應該正常打開
- 可以修改標題、描述、分類、標籤等
- 儲存後變更應該立即生效

#### 技術細節
- **前端檔案**: 
  - `client/src/views/admin/CustomPageList.vue`
  - `client/src/components/admin/CustomPageEditDialog.vue`
- **後端檔案**: `server/controllers/customPageController.js`
- **相關路由**: `PUT /api/custom-pages/:id`
- **問題類型**: 組件通信問題、API 調用問題

#### 已嘗試的修復
1. ✅ 修復了標籤處理邏輯（數組轉字符串）
2. ✅ 檢查了 `updateCustomPage` API 端點
3. ❌ 問題仍然存在

#### 需要進一步調查
- [ ] 檢查編輯對話框組件的 `v-model` 綁定
- [ ] 驗證 `selectedCustomPage` 數據傳遞
- [ ] 檢查表單驗證邏輯
- [ ] 測試 API 請求的數據格式
- [ ] 檢查後端數據更新邏輯

#### 相關錯誤訊息
```
更新失敗
或
表單驗證失敗
```

---

### Issue #003: 客製化頁面檔案解壓縮問題
- **狀態**: 🔴 Critical
- **優先級**: 🔴 Critical
- **發現日期**: 2024-01-XX
- **負責人**: 待分配

#### 問題描述
上傳的客製化頁面 ZIP 檔案可能沒有正確解壓縮到指定目錄，導致查看功能無法正常工作。

#### 重現步驟
1. 上傳一個客製化頁面 ZIP 檔案
2. 等待處理完成
3. 嘗試查看該頁面

#### 實際行為
- 檔案解壓縮失敗
- 或檔案解壓縮到錯誤位置
- 或檔案權限問題

#### 預期行為
- ZIP 檔案應該正確解壓縮到 `server/public/custom-pages/[slug]/` 目錄
- 檔案權限應該正確設定

#### 技術細節
- **相關檔案**: `server/utils/fileProcessor.js`
- **解壓縮目錄**: `server/public/custom-pages/`
- **問題類型**: 檔案系統操作問題

#### 需要進一步調查
- [ ] 檢查解壓縮目錄是否存在
- [ ] 驗證檔案權限設定
- [ ] 檢查 ZIP 檔案格式和內容
- [ ] 測試不同操作系統的檔案路徑處理

---

## 其他已知問題

### Issue #004: Mongoose 重複索引警告
- **狀態**: 🟢 Medium
- **優先級**: 🟢 Medium
- **發現日期**: 2024-01-XX

#### 問題描述
服務器啟動時出現 Mongoose 重複索引警告。

#### 錯誤訊息
```
[MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
```

#### 修復建議
檢查 `server/models/CustomPage.js` 中的索引定義，移除重複的索引聲明。

---

## 修復優先級

### 高優先級（需要立即修復）
1. Issue #003: 客製化頁面檔案解壓縮問題
2. Issue #001: 客製化頁面查看功能無效
3. Issue #002: 客製化頁面編輯功能無效

### 中優先級
4. Issue #004: Mongoose 重複索引警告

---

## 修復記錄

### 2024-01-XX
- ✅ 修復了 `fs.readFile` 異步調用問題
- ✅ 修復了標籤處理邏輯
- ✅ 更新了查看功能的 URL 構建邏輯

---

## 測試計劃

### 客製化頁面功能測試
- [ ] 上傳客製化頁面 ZIP 檔案
- [ ] 驗證檔案解壓縮和目錄結構
- [ ] 測試查看功能
- [ ] 測試編輯功能
- [ ] 測試刪除功能
- [ ] 測試在 PlayBook 中的整合

### 瀏覽器相容性測試
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

---

## 注意事項

1. 修復任何問題前，請先創建備份
2. 修復後請更新本文檔的狀態
3. 重要修復請提交 Pull Request
4. 定期檢查和更新問題清單

---

**最後更新**: 2024-01-XX
**維護者**: PlayBoard 開發團隊
