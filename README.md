# PlayBoard - 滿意度調查系統

> 系統整體架構與維護指南請參考：`docs/manual/SYSTEM_OVERVIEW.md`

PlayBoard 是一個全面的教育平台，支援測驗、問卷調查等多種學習工具。本文檔重點介紹新增的**滿意度調查功能**。

## 🎯 滿意度調查功能概覽

### 主要特色

- **李克特量表**：5 階級滿意度評分（非常不同意 → 非常同意）
- **簡述題**：開放式文字回答，用於收集詳細意見
- **多元題型**：支援單選、多選、李克特量表、簡述題
- **即時統計**：自動生成回答統計與視覺化圖表
- **響應式設計**：支援桌面和移動設備

## ⏱️ 時間追蹤功能

### 功能特色

- **步驟時間追蹤**：記錄每個步驟的開始和結束時間
- **內容閱讀時間**：實時顯示內容閱讀進度
- **詳細時間統計**：提供步驟級別和整體的時間分析
- **離線支援**：網路中斷時仍能記錄時間數據
- **時間格式化**：智能顯示分鐘、小時等時間單位

### 時間記錄內容

- **步驟開始時間**：記錄用戶進入步驟的時間戳
- **步驟結束時間**：記錄用戶完成步驟的時間戳
- **閱讀時間**：內容步驟的實際閱讀時間（秒）
- **總學習時間**：累計所有步驟的時間
- **平均時間**：每個步驟的平均完成時間

### 時間顯示格式

- **秒級顯示**：`30秒`、`1分30秒`
- **分鐘級顯示**：`5分鐘`、`1小時30分鐘`
- **小時級顯示**：`2小時`、`1天2小時`

### 技術實現

- **前端追蹤**：使用 `setInterval` 實時更新時間
- **後端存儲**：在 `PlayBookProgress` 模型中記錄時間數據
- **離線備份**：本地存儲時間數據，網路恢復時同步
- **事件通知**：通過自定義事件通知其他組件時間更新

### 李克特量表階級

1. **非常不同意** - 分數：1 分，顏色：紅色
2. **不同意** - 分數：2 分，顏色：橙紅色
3. **普通** - 分數：3 分，顏色：黃色
4. **同意** - 分數：4 分，顏色：淺綠色
5. **非常同意** - 分數：5 分，顏色：綠色

## 🏗️ 系統架構

### 後端架構

- **技術棧**：Node.js + Express + MongoDB
- **模型設計**：
  - `Survey`：問卷主體，包含題目定義
  - `SurveyResponse`：學生回答記錄

### 前端架構

- **技術棧**：Vue 3 + Element Plus + TailwindCSS
- **頁面結構**：
  - 管理員：問卷 CRUD + 統計分析
  - 學生：問卷填答介面

## 📊 資料庫設計

### Survey 模型

```javascript
{
  title: String,        // 問卷標題
  description: String,  // 問卷描述
  questions: [          // 問題陣列
    {
      text: String,     // 問題內容
      type: String,     // 題型：'likert', 'text', 'single', 'multiple'
      options: [String], // 選項（僅單選/多選使用）
      isPositive: Boolean // 正面/負面題目標記
    }
  ],
  createdBy: ObjectId,  // 建立者
  timestamps: true      // 自動時間戳
}
```

### SurveyResponse 模型

```javascript
{
  survey: ObjectId,           // 關聯問卷
  studentName: String,        // 學生姓名
  playbook: ObjectId,         // 關聯學習路徑（可選）
  responses: Map,             // 回答內容（問題索引 → 答案）
  completionTime: Date,       // 完成時間
  timestamps: true            // 自動時間戳
}
```

## 🛠️ API 端點

### 管理員 API（需要認證）

```
GET    /api/surveys              # 獲取問卷列表
POST   /api/surveys              # 創建新問卷
GET    /api/surveys/:id          # 獲取問卷詳情
PUT    /api/surveys/:id          # 更新問卷
DELETE /api/surveys/:id          # 刪除問卷
GET    /api/surveys/:id/responses # 獲取回答統計
```

### 學生 API（公開）

```
POST   /api/surveys/:id/responses # 提交問卷回答
```

## 💻 使用方法

### 公開邏輯（PlayBook）

- 公開與否僅由 `status` 控制：
  - `draft`：草稿（前台不可見）
  - `published`：已發布（前台可見）
- 「公開設定 isPublic」已移除，不再影響任何可見性。

### 前端設定：PlayBook 總覽模式顯示開關

可透過前端設定檔控制「總覽模式」是否在 PlayBook 建立/編輯頁面中出現。

- 設定檔：`client/src/config/app.config.js`
- 參數：

```js
export default {
  features: {
    // true: 在 PlayBook 建立/編輯表單顯示「總覽模式」選項
    // false: 僅保留「逐步模式」選項
    showOverviewOptionInPlayBookForm: true,
  },
};
```

生效範圍：

- `client/src/views/admin/PlayBookCreate.vue`
- `client/src/views/admin/PlayBookEdit.vue`

說明：

- 當 `showOverviewOptionInPlayBookForm` 設為 `false` 時，建立/編輯表單內的展示模式只會提供「逐步模式」以保持體驗一致。

### 管理員操作

#### 1. 創建問卷

1. 登入管理後台
2. 導航至「內容管理」→「滿意度調查」
3. 點擊「新增問卷」
4. 填寫問卷標題和描述
5. 新增問題：
   - **滿意度量表**：選擇「滿意度量表（5 階級）」
   - **簡述題**：選擇「簡述題（文字回答）」
   - **其他題型**：單選題、多選題
6. 儲存問卷

#### 2. 查看統計

1. 在問卷列表點擊「統計」按鈕
2. 查看各類統計數據：
   - **李克特量表**：平均分數、分布圖、百分比
   - **簡述題**：所有文字回答列表
   - **選擇題**：選項統計

#### 3. 分享問卷

1. 進入問卷詳情頁面
2. 複製問卷連結
3. 分享給學生填寫

### 學生操作

#### 填寫問卷

1. 通過連結訪問問卷：`/surveys/:id/take`
2. 輸入姓名
3. 依序回答所有問題：
   - **滿意度量表**：點選 1-5 分評分
   - **簡述題**：輸入文字回答
   - **選擇題**：選擇對應選項
4. 點擊「提交問卷」

## 🎨 前端組件

### 管理員頁面

- `SurveyList.vue`：問卷列表管理
- `SurveyCreate.vue`：創建新問卷
- `SurveyEdit.vue`：編輯現有問卷
- `SurveyRead.vue`：查看問卷詳情
- `SurveyResponses.vue`：統計分析頁面

### 學生頁面

- `SurveyTake.vue`：問卷填答介面

### 服務層

- `survey.service.js`：統一的 API 調用服務

## 📈 統計功能

### 李克特量表統計

- **平均分數**：自動計算平均值（1-5 分）
- **分布統計**：各分數的人數和百分比
- **視覺化圖表**：進度條顯示分布情況

### 簡述題統計

- **回答列表**：顯示所有文字回答
- **學生標記**：顯示回答者姓名和時間
- **匯出功能**：支援 JSON 格式匯出

### 資料匯出

- 支援完整統計資料匯出
- JSON 格式，便於進一步分析
- 包含問卷結構、統計數據、回答詳情

## 📊 PlayBook 統計分析與下載功能

### 功能特色

- **詳細時間統計**：記錄每個用戶的學習時間，包含最小/最大/平均時間
- **步驟級別分析**：追蹤每個步驟的完成情況和時間花費
- **多格式下載**：支援 JSON 和 CSV 格式下載用戶結果
- **完整數據導出**：包含用戶進度、時間記錄、步驟詳情等完整信息

### 統計分析內容

- **總用戶數**：參與該 PlayBook 的用戶總數
- **完成用戶數**：已完成整個 PlayBook 的用戶數
- **完成率**：完成用戶數 / 總用戶數
- **平均進度**：所有用戶的平均完成進度
- **時間統計**：
  - 平均完成時間
  - 最短完成時間
  - 最長完成時間
  - 總學習時間

### 下載功能

#### API 端點

```
GET /api/playbooks/:id/download?format=json|csv
```

#### 下載格式

1. **JSON 格式**：完整的結構化數據，便於程式處理
2. **CSV 格式**：表格化數據，便於 Excel 分析

#### 下載內容

- PlayBook 基本資訊
- 統計摘要
- 詳細用戶結果：
  - 用戶 ID 和姓名
  - 開始/完成/最後活動時間
  - 完成狀態和進度
  - 總學習時間
  - 步驟詳情（包含每個步驟的時間記錄）

### 使用方法

1. 進入管理後台
2. 導航至「PlayBook 管理」→「統計分析」
3. 選擇要分析的 PlayBook
4. 查看詳細統計數據
5. 點擊「下載結果」按鈕
6. 選擇下載格式（JSON 或 CSV）
7. 檔案將自動下載到本地

## 🔧 技術實現細節

### 李克特量表實現

```javascript
// 固定的5階級選項
const likertOptions = [
  { value: 5, label: "非常同意", color: "#67C23A" },
  { value: 4, label: "同意", color: "#95D475" },
  { value: 3, label: "普通", color: "#E6A23C" },
  { value: 2, label: "不同意", color: "#F56C6C" },
  { value: 1, label: "非常不同意", color: "#F78989" },
];
```

### 資料驗證

- 後端：Mongoose Schema 驗證
- 前端：Element Plus 表單驗證
- 回答完整性檢查

### 安全性考量

- 管理員功能需要身份驗證
- 學生填答為公開功能（僅需姓名）
- 輸入資料清理和驗證

## 🚀 部署說明

### 開發環境

```bash
# 後端
cd server
npm install
npm run dev

# 前端
cd client
npm install
npm run dev
```

### 生產環境

1. 建置前端：`npm run build`
2. 設定環境變數
3. 啟動後端服務
4. 配置反向代理

## 🎨 客製化頁面功能

### 功能特色

- **ZIP 檔案上傳**：支援上傳包含 HTML/CSS/JavaScript 的完整頁面
- **自動解壓處理**：自動驗證和解壓 ZIP 檔案
- **進度控制**：支援手動、計時、互動、完成等多種進度觸發方式
- **PlayBook 整合**：可作為 PlayBook 學習路徑中的步驟
- **安全沙盒**：使用 iframe 沙盒模式確保安全性
- **進度追蹤**：完整的學習進度記錄和統計

### 支援的檔案類型

- **HTML**: `.html`, `.htm`
- **CSS**: `.css`
- **JavaScript**: `.js`
- **圖片**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`, `.svg`
- **字體**: `.woff`, `.woff2`, `.ttf`, `.otf`
- **其他**: `.json`, `.txt`, `.md`

### 檔案規範

- **ZIP 檔案大小**：最大 50MB
- **單一檔案大小**：最大 10MB
- **檔案數量**：最多 1000 個檔案
- **必要檔案**：必須包含 `index.html`

### 進度觸發類型

1. **手動觸發**：用戶必須手動點擊「下一步」
2. **計時觸發**：經過指定時間後自動進入下一步
3. **互動觸發**：用戶完成特定互動後觸發
4. **完成觸發**：完成特定任務後自動觸發

### 使用方法

1. **管理員上傳**：

   - 進入「客製化頁面管理」
   - 點擊「上傳新頁面」
   - 填寫頁面資訊並上傳 ZIP 檔案
   - 系統自動處理和驗證

2. **PlayBook 整合**：

   - 在 PlayBook 創建/編輯頁面
   - 選擇步驟類型為「客製化頁面」
   - 選擇已上傳的客製化頁面
   - 設定進度觸發方式

3. **學生學習**：
   - 在 PlayBook 中自動載入客製化頁面
   - 根據設定進行互動學習
   - 自動記錄學習進度和結果

## 📝 更新日誌

### v1.3.0 - 客製化頁面功能

- ✅ 新增客製化頁面管理功能
- ✅ 支援 ZIP 檔案上傳和自動解壓
- ✅ 整合 PlayBook 學習路徑
- ✅ 實作多種進度觸發機制
- ✅ 完整的進度追蹤和統計
- ✅ 安全的沙盒執行環境
- ✅ 響應式管理介面

### v1.2.0 - 統計分析與下載功能

- ✅ 修復 PlayBook 統計分析的時間記錄問題
- ✅ 增強時間統計功能，包含最小/最大/總時間統計
- ✅ 新增 PlayBook 用戶結果下載功能（JSON/CSV 格式）
- ✅ 優化統計頁面顯示，增加時間範圍信息
- ✅ 完善用戶結果數據結構，包含詳細步驟信息

### v1.1.0 - 時間追蹤功能

- ✅ 新增步驟時間追蹤機制
- ✅ 內容閱讀時間實時顯示
- ✅ 詳細的時間記錄和統計
- ✅ 步驟完成時間記錄
- ✅ 離線時間記錄支援
- ✅ 修復完成學習後返回總覽的自動跳轉問題
- ✅ 修復測驗和問卷步驟的計時功能

### v1.0.0 - 滿意度調查功能

- ✅ 完整的問卷 CRUD 功能
- ✅ 李克特 5 階級量表支援
- ✅ 簡述題功能
- ✅ 即時統計分析
- ✅ 響應式學生填答介面
- ✅ 資料匯出功能
- ✅ 管理後台整合

## 🔮 未來規劃

### 功能擴展

- [ ] 問卷模板系統
- [ ] 批量匯入問題
- [ ] 更多統計圖表類型
- [ ] 自動報告生成
- [ ] 問卷有效期設定

### 效能優化

- [ ] 大量回答資料分頁
- [ ] 統計資料快取
- [ ] 資料庫索引優化

## 開發者指南

### 客製化頁面開發

- [客製化頁面設計指南](docs/客製化頁面設計指南.md) - 選擇適合您的版本
  - [初學者版](docs/客製化頁面設計指南-初學者版.md) - 提供現成代碼模板
  - [進階版](docs/客製化頁面設計指南-進階版.md) - 完整技術文檔
- [簡單測驗範例](docs/examples/simple-quiz/) - 實際範例代碼

### 快速開始

1. 閱讀設計指南
2. 複製範例代碼
3. 修改內容
4. 打包上傳

## 問題追蹤

- [問題與 Bug 清單](docs/ISSUES_AND_BUGS.md) - 已知問題和修復狀態
- [客製化頁面調試指南](docs/客製化頁面調試指南.md) - 詳細的調試步驟和工具

## 技術支援

如有問題或建議，請參考：

1. 查看錯誤日誌
2. 檢查資料庫連線
3. 確認 API 端點正常運作
4. 參考開發者指南
5. 查看問題追蹤文檔
6. 聯繫開發團隊

---

**PlayBoard 滿意度調查系統** - 讓教育回饋更簡單、更有效！
